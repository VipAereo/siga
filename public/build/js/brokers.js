let gridOptions,currentStep=1;function asignarEventos(){$(".prefSearch").hide(),document.addEventListener("keydown",a=>{"Escape"===a.key&&resetearFormularioBrokers()}),document.getElementById("preferencia_id").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".prefSearch").show(),$(".inPrefSrch").focus();let e=await obtenerPreferencia();await mostrarListaSearch(e,".prefSearch","tipo_id","nombre")}))}function configurarBotones(){$(".contenedor-altas").hide(),$("#crear-broker").click(mostrarContenedorAltas),$(".btn-next").click((function(a){let e;a.preventDefault(),1==currentStep&&(e=validateInputs($("#broker_formulario-broker"))),2==currentStep&&(e=validateInputs($("#broker_formulario-contacto"))),e&&($("#paso"+currentStep).hide(),currentStep++,$("#paso"+currentStep).show(),updateActiveClass())})),$(".btnCancel").click(a=>{currentStep=1,resetearFormularioBrokers()}),$(".btn-prev").click((function(a){a.preventDefault(),$("#paso"+currentStep).hide(),currentStep--,$("#paso"+currentStep).show(),updateRemoveClass()})),$("#btnGuardar").click(a=>{validateInputs($("#broker_formulario-broker"))&&(""==$("#broker_id").val()?crearBroker():actualizarBroker())}),$("#comision").on("change",(function(){$(".input-empr-desc").toggleClass("hidden",!this.checked),$("#descuento").val("")})),updateActiveClass(),updateRemoveClass()}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"broker_id",width:60},{headerName:"Siglas",field:"siglas_empresa",width:100},{headerName:"Nombre",field:"nombre",width:150},{headerName:"Teléfono",field:"telefono",width:120},{headerName:"Email",field:"email",width:120},{headerName:"Contacto",field:"contacto_principal",width:150},{headerName:"Razón Social",field:"razon_social",width:120},{headerName:"Dirección",field:"calle",width:120},{headerName:"Estatus",field:"estatus",width:100},{headerName:"Acción",cellRenderer:function(a){const e=document.createElement("I");e.className="fa-regular fa-pen-to-square btn btn-editar",e.title="Editar",e.addEventListener("click",(async function(){await mostrarContenedorAltas(),$("#broker_id").val(a.data.broker_id),$("#nombre").val(a.data.nombre),$("#siglas_empresa").val(a.data.siglas_empresa),$("#telefono").val(a.data.telefono),$("#email").val(a.data.email),$("#sitio_web").val(a.data.sitio_web),$("#contacto_principal").val(a.data.contacto_principal),$("#calle").val(a.data.calle),$("#num_ext").val(a.data.num_ext),$("#num_int").val(a.data.num_int),$("#ciudad").val(a.data.ciudad),$("#estado").val(a.data.estado),$("#municipio").val(a.data.municipio),$("#codigo_postal").val(a.data.codigo_postal),$("#colonia").val(a.data.colonia),$("#pais").val(a.data.pais),$("#rfc").val(a.data.rfc),$("#razon_social").val(a.data.razon_social),$("#regimen_fiscal").val(a.data.regimen_fiscal),$("#giro_comercial").val(a.data.giro_comercial),$("#estatus").val(a.data.estatus),1==a.data.ischecked?($("#comision").prop("checked",!0),$(".input-empr-desc").removeClass("hidden")):$("#comision").prop("checked",!1),$("#descuento").val(a.data.descuento),$("#preferencia_id option").val(a.data.tarifa_id),$("#preferencia_id option").text(a.data.tipo_nombre)}));const r=document.createElement("div");return r.classList="btn-cont centrado",r.appendChild(e),r},width:150,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traerBrokers()}async function mostrarContenedorAltas(){$(".contenedor-altas").show(),aplicarMascaraCantidad("descuento")}async function traerBrokers(){try{const a=await fetch("obtener/brokers",{method:"GET"}),e=await a.json();let r=verificarArray(e);gridApi.setGridOption("rowData",r)}catch(a){console.error(a),SwalToast("warning","Error al obtener los usuarios",2500)}}async function obtenerPreferencia(){try{const a=await fetch("tarifa/tipo",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Tarifas disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}function updateActiveClass(){$(".empleado_pasos p").removeClass("pasoActivo"),1===currentStep?($(".paso1 p").addClass("pasoActivo"),$(".btn-guardar").addClass("hidden"),$(".btn-next").removeClass("hidden")):2===currentStep?($(".paso2 p").addClass("pasoActivo"),$(".paso1 p").addClass("circle-check"),$(".btn-prev").removeClass("invisible")):3===currentStep&&($(".paso3 p").addClass("pasoActivo"),$(".paso2 p").addClass("circle-check"),$(".btn-next").addClass("hidden"),$(".btn-guardar").removeClass("hidden"))}function updateRemoveClass(){$(".empleado_pasos p").removeClass("circle-check"),1===currentStep?($(".paso1 p").addClass("pasoActivo"),$(".paso2 p").removeClass("pasoActivo"),$(".btn-prev").addClass("invisible")):2===currentStep&&($(".paso1 p").addClass("circle-check"),$(".paso2 p").addClass("pasoActivo"),$(".paso3 p").removeClass("pasoActivo"),$(".btn-next").removeClass("hidden"),$(".btn-guardar").addClass("hidden"))}function resetearFormularioBrokers(){cerrarVentana(".contenedor-altas",["#broker_formulario-broker","#broker_formulario-contacto","#broker_formulario-fiscal"]),$(".altas_pasos p").removeClass("pasoActivo circle-check"),$("#paso1").show(),$("#paso2").hide(),$("#paso3").hide(),$(".paso1 p").addClass("pasoActivo"),$(".input-empr-desc").addClass("hidden"),currentStep=1,updateRemoveClass(),updateActiveClass()}async function crearBroker(){const a=$("#nombre").val(),e=$("#siglas_empresa").val(),r=$("#telefono").val(),o=$("#email").val(),t=$("#sitio_web").val(),n=$("#contacto_principal").val(),i=$("#calle").val(),s=$("#num_ext").val(),c=$("#num_int").val(),l=$("#ciudad").val(),d=$("#estado").val(),p=$("#municipio").val(),u=$("#codigo_postal").val(),m=$("#colonia").val(),v=$("#pais").val(),f=$("#rfc").val(),_=$("#razon_social").val(),h=$("#regimen_fiscal").val(),b=$("#giro_comercial").val(),w=$("#estatus").val();let k=$("#comision").prop("checked")?1:0;const C=sinComa($("#descuento").val()),g=$("#preferencia_id").val();try{const $=new FormData;$.append("nombre",a),$.append("siglas_empresa",e),$.append("telefono",r),$.append("email",o),$.append("sitio_web",t),$.append("contacto_principal",n),$.append("calle",i),$.append("num_ext",s),$.append("num_int",c),$.append("ciudad",l),$.append("estado",d),$.append("municipio",p),$.append("codigo_postal",u),$.append("colonia",m),$.append("pais",v),$.append("rfc",f),$.append("razon_social",_),$.append("regimen_fiscal",h),$.append("giro_comercial",b),$.append("estatus",w),$.append("ischecked",k),$.append("descuento",C),$.append("tarifa_id",g);const S=await fetch("crear/broker",{method:"POST",body:$}),A=await S.json();1==A.exito?(SwalLoad("success","Éxito","Registro Creado Correctamente",!1),setTimeout(()=>{swal.close(),resetearFormularioBrokers(),traerBrokers()},1500)):0==A.exito&&SwalLoad("error","Error en la Transacción",A.errorSMS,!0),A.alertas&&SwalToast("warning",A.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function actualizarBroker(){const a=$("#broker_id").val(),e=$("#nombre").val(),r=$("#siglas_empresa").val(),o=$("#telefono").val(),t=$("#email").val(),n=$("#sitio_web").val(),i=$("#contacto_principal").val(),s=$("#calle").val(),c=$("#num_ext").val(),l=$("#num_int").val(),d=$("#ciudad").val(),p=$("#estado").val(),u=$("#municipio").val(),m=$("#codigo_postal").val(),v=$("#colonia").val(),f=$("#pais").val(),_=$("#rfc").val(),h=$("#razon_social").val(),b=$("#regimen_fiscal").val(),w=$("#giro_comercial").val(),k=$("#estatus").val();let C=$("#comision").prop("checked")?1:0;const g=sinComa($("#descuento").val()),S=$("#preferencia_id").val();try{const $=new FormData;$.append("broker_id",a),$.append("nombre",e),$.append("siglas_empresa",r),$.append("telefono",o),$.append("email",t),$.append("sitio_web",n),$.append("contacto_principal",i),$.append("calle",s),$.append("num_ext",c),$.append("num_int",l),$.append("ciudad",d),$.append("estado",p),$.append("municipio",u),$.append("codigo_postal",m),$.append("colonia",v),$.append("pais",f),$.append("rfc",_),$.append("razon_social",h),$.append("regimen_fiscal",b),$.append("giro_comercial",w),$.append("estatus",k),$.append("ischecked",C),$.append("descuento",g),$.append("tarifa_id",S);const A=await fetch("actualizar/broker",{method:"POST",body:$}),x=await A.json();1==x.exito?(SwalLoad("success","Éxito","Registro Actualizado Correctamente",!1),setTimeout(()=>{swal.close(),resetearFormularioBrokers(),traerBrokers()},1500)):0==x.exito&&SwalLoad("error","Error en la Transacción",x.errorSMS,!0),x.alertas&&SwalToast("warning",x.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=brokers.js.map
