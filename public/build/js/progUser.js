let gridOptions,USUARIOS_ACTIVOS="";function asignarEventos(){document.addEventListener("keydown",e=>{"Escape"===e.key&&cerrarVentana(".contenedor-altas",["#formAltas"])})}function configurarBotones(){$(".contenedor-altas").hide(),$("#btnCancel").click(e=>{resetearTabla("#myGrid2","#searchInput1"),limpiarForm("#formAltas"),$(".contenedor-altas").hide()}),$("#btnGuardar").click(e=>{let a=getDataFromGrid(),r=USUARIOS_ACTIVOS.filter((function(e){let r=a.find((function(a){return e.programa_id===a.programa_id&&e.nombre===a.nombre}));return r&&!e.rel&&r.relacion})),o=USUARIOS_ACTIVOS.filter((function(e){let r=a.find((function(a){return e.programa_id===a.programa_id&&e.nombre===a.nombre}));return r&&e.rel&&!r.relacion}));r.length>0&&crearRelacion(r),o.length>0&&eliminarRelacion(o)})}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"usuario_id",width:80},{headerName:"Rol",field:"nombre_user",width:400},{headerName:"Acción",cellRenderer:function(e){const a=document.createElement("I");a.className="fa-regular fa-pen-to-square btn btn-editar",a.title="Editar",a.addEventListener("click",(async function(){$("#user-title").text("Usuario - "+e.data.nombre_user),$("#usuario_id").val(e.data.usuario_id),await mostrarContenedorAltas(e.data.usuario_id),document.addEventListener("keydown",(function e(a){"Escape"===a.key&&(resetearTabla("#myGrid2","#searchInput1"),document.removeEventListener("keydown",e))}))}));const r=document.createElement("div");return r.classList="btn-cont centrado",r.appendChild(a),r},width:160,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traerProgUsuarios()}async function traerProgUsuarios(){try{const e=await fetch("usuarios/activos",{method:"GET"}),a=await e.json();let r=verificarArray(a);gridApi.setGridOption("rowData",r)}catch(e){console.error(e),SwalToast("warning","Error al obtener los usuarios",2500)}}async function mostrarContenedorAltas(e){$(".contenedor-altas").show();iniciarTabla("",[{headerName:"id",field:"programa_id",width:80},{headerName:"nombre",field:"nombre",width:400},{headerName:"Selección",field:"relacion",editable:!0,width:150,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor"}],"#myGrid2"),obtenerRelaciones(e)}async function obtenerRelaciones(e){try{const a=new FormData;a.append("usuario_id",e);const r=await fetch("progUsuario/relaciones",{method:"POST",body:a}),o=await r.json();USUARIOS_ACTIVOS=o.map(e=>({programa_id:e.programa_id,nombre:e.nombre,rel:e.relacion}));let n=verificarArray(o);gridApi.setGridOption("rowData",n)}catch(e){console.error(e),SwalToast("warning","Error al obtener los usuarios",2500)}}async function crearRelacion(e){let a=$("#usuario_id").val();try{const r=new FormData;r.append("usuario_id",a),r.append("datosInsertar",JSON.stringify(e));const o=await fetch("crear/progUsuarios",{method:"POST",body:r}),n=await o.json();1==n.exito?(SwalLoad("success","Éxito","Relación Creada Correctamente",!1),setTimeout(()=>{swal.close(),obtenerRelaciones(a)},1500)):0==n.exito&&SwalLoad("error","Error en la Transacción",n.errorSMS,!0),n.alertas&&(SwalToast("warning",n.alertas.error,2500),cerrarVentana(".contenedor-altas",["#formAltas"]))}catch(e){console.error(e),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function eliminarRelacion(e){let a=$("#usuario_id").val();try{const r=new FormData;r.append("usuario_id",a),r.append("datosEliminar",JSON.stringify(e));const o=await fetch("eliminar/progUsuarios",{method:"POST",body:r}),n=await o.json();1==n.exito?(SwalLoad("success","Éxito","Relación Eliminada Correctamente",!1),setTimeout(()=>{swal.close(),obtenerRelaciones(a)},1500)):0==n.exito&&SwalLoad("error","Error en la Transacción",n.errorSMS,!0),n.alertas&&(SwalToast("warning",n.alertas.error,2500),cerrarVentana(".contenedor-altas",["#formAltas"]))}catch(e){console.error(e),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=progUser.js.map
