let gridOptions;function asignarEventos(){$(".contenedor-altas").hide(),$(".categSearch").hide(),aplicarMascaraCantidad("precio"),document.addEventListener("keydown",e=>{"Escape"===e.key&&resetForm()}),document.getElementById("categoria_id").addEventListener("mousedown",(async function(e){e.preventDefault(),$(".categSearch").show(),$(".inCategSrch").focus();let a=await obtenerCategorias();a=a.filter(e=>"Ruta"!==e.nombre&&"Pernocta"!==e.nombre&&"Aterrizaje"!==e.nombre&&"Tua"!==e.nombre);await mostrarListaSearch(a,".categSearch","categoria_id","nombre")}))}function configurarBotones(){$("#crear-prod").click(mostrarContenedorAltas),$(".btn-cancelar").click(e=>{resetForm()}),$("#btnGuardar").click(e=>{validateInputs($("#formAltas"))&&(""==$("#producto_id").val()?crearProd():actualizarProd())})}async function inicializarPagina(){let e=await obtenerCategorias(),a={};e.forEach(e=>{a[e.categoria_id]=e.nombre});let r=[{headerName:"id",field:"producto_id",width:80},{headerName:"Nombre",field:"nombre",width:180},{headerName:"Descripción",field:"descripcion",width:200},{headerName:"Categoría",field:"categoria_id",width:120,valueFormatter:function(e){let r=e.data.categoria_id;return a[r]||""}},{headerName:"Precio",field:"precio",width:140,cellStyle:{textAlign:"right"},valueFormatter:function(e){return Number(e.value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{headerName:"Acción",width:148,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1,cellRenderer:function(e){const a=document.createElement("I");a.className="fa-regular fa-pen-to-square btn btn-editar",a.title="Editar",a.addEventListener("click",(async function(){await mostrarContenedorAltas(),$("#producto_id").val(e.data.producto_id),$("#nombre").val(e.data.nombre),$("#descripcion").val(e.data.descripcion),$("#precio").val(e.data.precio),$("#categoria_id option").val(e.data.categoria_id),$("#categoria_id option").text(e.data.nombreCat),$("#categoria_id").addClass("event-none input-disabled")}));const r=document.createElement("div");return r.classList="btn-cont centrado",r.appendChild(a),r}}];await iniciarTabla("",r,"#myGrid"),obtenerProductos()}async function mostrarContenedorAltas(){$(".contenedor-altas").show()}function resetForm(){$("#contenedor-docs").empty(),cerrarVentana(".contenedor-altas",["#formAltas"]),$("#categoria_id").removeClass("event-none input-disabled")}async function obtenerProductos(){try{const e=await fetch("obtener/productos",{method:"GET"}),a=await e.json();let r=verificarArray(a);gridApi.setGridOption("rowData",r)}catch(e){console.error(e),SwalToast("warning","Error al obtener los datos",2500)}}async function obtenerCategorias(){try{const e=await fetch("../obtener/categorias",{method:"GET"}),a=await e.json();return!a.length>0&&SwalToast("warning","No hay Categorias disponibles.",2500),a}catch(e){console.error(e),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function crearProd(){try{const e=$("#nombre").val(),a=$("#categoria_id").val(),r=$("#descripcion").val(),o=sinComa($("#precio").val()),t=new FormData;t.append("nombre",e),t.append("categoria_id",a),t.append("descripcion",r),t.append("precio",o);const n=await fetch("crear/producto",{method:"POST",body:t}),i=await n.json();1==i.exito?(SwalLoad("success","Éxito","Registro Creado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),obtenerProductos()},1500)):0==i.exito&&SwalLoad("error","Error en la Transacción",i.errorSMS,!0),i.alertas&&SwalToast("warning",i.alertas.error,2500)}catch(e){console.error(e),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function actualizarProd(){try{const e=$("#producto_id").val(),a=$("#nombre").val(),r=$("#categoria_id").val(),o=$("#descripcion").val(),t=sinComa($("#precio").val()),n=new FormData;n.append("producto_id",e),n.append("nombre",a),n.append("categoria_id",r),n.append("descripcion",o),n.append("precio",t);const i=await fetch("actualizar/producto",{method:"POST",body:n}),c=await i.json();1==c.exito?(SwalLoad("success","Éxito","Registro Actualizado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),obtenerProductos()},1500)):0==c.exito&&SwalLoad("error","Error en la Transacción",c.errorSMS,!0),c.alertas&&SwalToast("warning",c.alertas.error,2500)}catch(e){console.error(e),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=producto.js.map
