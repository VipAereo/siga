let gridOptions;function asignarEventos(){$(".rutaSearch").hide(),$(".aeronSearch").hide(),document.addEventListener("keydown",a=>{"Escape"===a.key&&resetForm()}),aplicarMascaraCantidad("costo","impuesto","descuento"),document.getElementById("ruta_id").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".rutaSearch").show(),$(".inRutaSrch").focus();let e=await obtenerRutas();await mostrarListaSearch(e,".rutaSearch","ruta_id","rutas_nombre");obtenerDetalleTarifa()})),document.getElementById("aeronave_id").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".aeronSearch").show(),$(".inAeronSrch").focus();let e=await obtenerAeronaves();await mostrarListaSearch(e,".aeronSearch","aeronave_id","modelo");obtenerDetalleTarifa()}))}function configurarBotones(){$(".contenedor-altas").hide(),$("#crear-tarifa").click(mostrarContenedorAltas),$(".btn-cancelar").click(a=>{resetForm()}),$("#btnGuardar").click(a=>{validateInputs($("#formAltas"))&&(""==$("#tarifa_id").val()?crearTarifa():actualizarTarifa())})}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"tarifa_id",width:80},{headerName:"Concepto",field:"concepto",width:150},{headerName:"Ruta",field:"ruta",width:180},{headerName:"Aeronave",field:"modelo",width:150},{headerName:"Tipo de Vuelo",field:"tipo_vuelo",width:120},{headerName:"Tiempo Estimado",field:"tiempo_estimado",width:120},{headerName:"Costo",field:"costo",width:130,cellStyle:{textAlign:"right"},valueFormatter:function(a){return Number(a.value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{headerName:"Tipo de Vuelo",field:"tipo_vuelo",width:120,valueFormatter:function(a){return{N:"Nacional",I:"Internacional"}[a.value]||a.value}},{headerName:"Acción",cellRenderer:function(a){const e=document.createElement("I");e.className="fa-regular fa-pen-to-square btn btn-editar",e.title="Editar",e.addEventListener("click",(async function(){await mostrarContenedorAltas(),$("#tarifa_id").val(a.data.tarifa_id),$("#tiempo_estimado").val(a.data.tiempo_estimado),$("#concepto").val(a.data.concepto),$("#tipo_vuelo").val(a.data.tipo_vuelo),$("#costo").val(a.data.costo),$("#impuesto").val(a.data.impuesto),$("#descuento").val(a.data.descuento),$("#ruta_id option").val(a.data.ruta_id),$("#ruta_id option").text(a.data.ruta),$("#aeronave_id option").val(a.data.aeronave_id),$("#aeronave_id option").text(a.data.modelo),$("#tarifa_id").val()&&($("#ruta_id").addClass("input-disabled"),$("#aeronave_id").addClass("input-disabled"))}));const t=document.createElement("div");return t.classList="btn-cont centrado",t.appendChild(e),t},width:150,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traerTarifas()}function resetForm(){cerrarVentana(".contenedor-altas",["#formAltas"])}async function mostrarContenedorAltas(){$(".contenedor-altas").show(),$("#ruta_id").removeClass("input-disabled"),$("#aeronave_id").removeClass("input-disabled"),await obtenerRutas(),await obtenerAeronaves()}async function obtenerRutas(){try{const a=await fetch("/obtener/rutas",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Programas disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function obtenerAeronaves(){try{const a=await fetch("/aeronaves/activas",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Programas disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function obtenerDetalleTarifa(){console.log("calculando..."),$("#tiempo_estimado").val("");let a=$("#ruta_id").val(),e=$("#aeronave_id").val();if(a&&e)try{const t=new FormData;t.append("ruta_id",a),t.append("aeronave_id",e);const o=await fetch("/obtener/detalleTarifa",{method:"POST",body:t}),r=await o.json();if(r.exito){let a=r.exito[0].distancia,e=r.exito[0].ktas;if(a&&e>0){let t=calcularTiempoEstimado(a,e);$("#tiempo_estimado").val(t)}}return r.alertas&&SwalToast("warning",r.alertas.error,2500),r}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}function calcularTiempoEstimado(a,e){let t=(a/(1.852*e)).toFixed(2),o=Math.floor(t);return o+":"+Math.round(60*(t-o))}async function traerTarifas(){try{const a=await fetch("obtener/tarifas",{method:"GET"}),e=await a.json();let t=verificarArray(e);gridApi.setGridOption("rowData",t)}catch(a){console.error(a),SwalToast("warning","Error al obtener los datos",2500)}}async function crearTarifa(){const a=$("#ruta_id").val(),e=$("#aeronave_id").val(),t=$("#tiempo_estimado").val(),o=$("#concepto").val(),r=$("#tipo_vuelo").val(),n=$("#costo").val(),i=$("#impuesto").val(),d=$("#descuento").val();try{const c=new FormData;c.append("ruta_id",a),c.append("aeronave_id",e),c.append("tiempo_estimado",t),c.append("concepto",o),c.append("tipo_vuelo",r),c.append("costo",n),c.append("impuesto",i),c.append("descuento",d);const s=await fetch("crear/tarifa",{method:"POST",body:c}),l=await s.json();1==l.exito?(SwalLoad("success","Éxito","Registro Creado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),traerTarifas()},1500)):0==l.exito&&SwalLoad("error","Error en la Transacción",l.errorSMS,!0),l.alertas&&SwalToast("warning",l.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function actualizarTarifa(){const a=$("#tarifa_id").val(),e=$("#ruta_id").val(),t=$("#aeronave_id").val(),o=$("#tiempo_estimado").val(),r=$("#concepto").val(),n=$("#tipo_vuelo").val(),i=$("#costo").val(),d=$("#impuesto").val(),c=$("#descuento").val();try{const s=new FormData;s.append("tarifa_id",a),s.append("ruta_id",e),s.append("aeronave_id",t),s.append("tiempo_estimado",o),s.append("concepto",r),s.append("tipo_vuelo",n),s.append("costo",i),s.append("impuesto",d),s.append("descuento",c);const l=await fetch("actualizar/tarifa",{method:"POST",body:s}),u=await l.json();console.log(u),1==u.exito?(SwalLoad("success","Éxito","Registro Creado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),traerTarifas()},1500)):0==u.exito&&SwalLoad("error","Error en la Transacción",u.errorSMS,!0),u.alertas&&SwalToast("warning",u.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=tarifas.js.map
