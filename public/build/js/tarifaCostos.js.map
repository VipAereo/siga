{"version":3,"sources":["tarifaCostos.js"],"names":["gridOptions","asignarEventos","$","hide","document","addEventListener","e","key","resetForm","aplicarMascaraCantidad","getElementById","async","event","preventDefault","show","focus","data","obtenerAeronaves","mostrarListaSearch","obtenerPreferencia","configurarBotones","click","mostrarContenedorAltas","validateInputs","val","crearTarifa","actualizarTarifa","inicializarPagina","iniciarTabla","headerName","field","width","cellStyle","textAlign","valueFormatter","params","Number","value","toFixed","replace","cellRenderer","editButton","createElement","className","title","costo_id","preferencia","costo_mx","costo_usd","aeronave_id","text","modelo","addClass","tarifa_id","tipo_nombre","actionContainer","classList","appendChild","headerClass","cellClass","filter","traerTarifas","cerrarVentana","respuesta","fetch","method","json","length","SwalToast","error","console","SwalLoad","convert","verificarArray","gridApi","setGridOption","sinComa","datos","FormData","append","body","exito","setTimeout","swal","close","errorSMS","alertas"],"mappings":"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","file":"tarifaCostos.js","sourcesContent":["let gridOptions;\r\n\r\n// Utilizando el Principio de Modularidad\r\n$(function () {\r\n    asignarEventos();\r\n    inicializarPagina();\r\n    configurarBotones();\r\n});\r\nfunction asignarEventos() {\r\n    $('.aeronSearch').hide();\r\n    $('.prefSearch').hide();\r\n\r\n    document.addEventListener(\"keydown\", e => {\r\n        if (e.key === 'Escape') {\r\n            resetForm();\r\n        }\r\n    });\r\n\r\n    aplicarMascaraCantidad('costo_mx', 'costo_usd');\r\n\r\n    // Lista Aeronaves\r\n    document.getElementById(\"aeronave_id\").addEventListener(\"mousedown\", async function (event) {\r\n        event.preventDefault();\r\n        $('.aeronSearch').show();\r\n        $('.inAeronSrch').focus()\r\n        let data = await obtenerAeronaves();\r\n        const listSearch = await mostrarListaSearch(data, '.aeronSearch', 'aeronave_id', 'modelo');\r\n    });\r\n\r\n    // Lista Preferencia\r\n    document.getElementById(\"preferencia_id\").addEventListener(\"mousedown\", async function (event) {\r\n        event.preventDefault();\r\n        $('.prefSearch').show();\r\n        $('.inPrefSrch').focus();\r\n        let data = await obtenerPreferencia();\r\n        const listSearch = await mostrarListaSearch(data, '.prefSearch', 'tipo_id', 'nombre');\r\n    });\r\n}\r\nfunction configurarBotones() {\r\n    $(\".contenedor-altas\").hide();\r\n    $(\"#crear-tarifa\").click(mostrarContenedorAltas);\r\n\r\n    $(\".btn-cancelar\").click(e => {\r\n        resetForm();\r\n    });\r\n\r\n    $(\"#btnGuardar\").click(e => {\r\n        let validar = validateInputs($('#formAltas'));\r\n        if (validar) $('#costo_id').val() == '' ? crearTarifa() : actualizarTarifa();\r\n    });\r\n}\r\nfunction inicializarPagina() {\r\n\r\n    let columnDefs = [\r\n        {\r\n            headerName: 'id',\r\n            field: 'costo_id',\r\n            width: 80\r\n        },\r\n        {\r\n            headerName: 'Aeronave',\r\n            field: 'modelo',\r\n            width: 150\r\n        },\r\n        {\r\n            headerName: 'Preferencia',\r\n            field: 'tipo_nombre',\r\n            width: 130\r\n        },\r\n        {\r\n            headerName: 'Costo Nacional',\r\n            field: 'costo_mx',\r\n            width: 120,\r\n            cellStyle: { textAlign: 'right' }, // Alinea los datos a la derecha\r\n            valueFormatter: function (params) {\r\n                // Formatea el número con comas como separadores de miles y dos decimales\r\n                return Number(params.value).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n            }\r\n        },\r\n        {\r\n            headerName: 'Costo Internacional',\r\n            field: 'costo_usd',\r\n            width: 120,\r\n            cellStyle: { textAlign: 'right' }, // Alinea los datos a la derecha\r\n            valueFormatter: function (params) {\r\n                // Formatea el número con comas como separadores de miles y dos decimales\r\n                return Number(params.value).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n            }\r\n        },\r\n        {\r\n            headerName: 'Fecha Creación',\r\n            field: 'fecha_creacion',\r\n            width: 130\r\n        },\r\n        {\r\n            headerName: 'Acción',\r\n            cellRenderer: function (params) {\r\n                const editButton = document.createElement('I');\r\n                editButton.className = \"fa-regular fa-pen-to-square btn btn-editar\";\r\n                editButton.title = 'Editar';\r\n\r\n                editButton.addEventListener('click', async function () {\r\n                    await mostrarContenedorAltas();\r\n\r\n                    $('#costo_id').val(params.data.costo_id);\r\n                    $('#preferencia').val(params.data.preferencia);\r\n                    $('#costo_mx').val(params.data.costo_mx);\r\n                    $('#costo_usd').val(params.data.costo_usd);\r\n                    $('#aeronave_id option').val(params.data.aeronave_id);\r\n                    $('#aeronave_id option').text(params.data.modelo);\r\n\r\n                    $('#aeronave_id').addClass('input-disabled');\r\n                    $('#costo_mx').addClass('input-disabled');\r\n                    $('#costo_usd').addClass('input-disabled');\r\n\r\n                    $('#preferencia_id option').val(params.data.tarifa_id);\r\n                    $('#preferencia_id option').text(params.data.tipo_nombre);\r\n                });\r\n\r\n                // Crea un contenedor para los botones y los agrega\r\n                const actionContainer = document.createElement('div');\r\n                actionContainer.classList = \"btn-cont centrado\";\r\n                actionContainer.appendChild(editButton);\r\n\r\n                return actionContainer;\r\n            },\r\n            width: 150,\r\n            headerClass: 'txt-center',\r\n            cellClass: 'custom-action-cell', // Agregar la clase CSS 'custom-action-cell' a todas las celdas en esta columna\r\n            filter: false\r\n        },\r\n    ];\r\n\r\n    let data = '';\r\n    iniciarTabla(data, columnDefs, '#myGrid');\r\n    traerTarifas();\r\n}\r\n// FUNCIONES\r\nfunction resetForm() {\r\n    cerrarVentana('.contenedor-altas', ['#formAltas']);\r\n}\r\nasync function mostrarContenedorAltas() {\r\n    $(\".contenedor-altas\").show();\r\n\r\n    await obtenerAeronaves();\r\n}\r\nasync function obtenerAeronaves() {\r\n    try {\r\n        const respuesta = await fetch('/aeronaves/activas', {\r\n            method: 'GET'\r\n        });\r\n        const data = await respuesta.json();\r\n        // console.log(data);\r\n\r\n        if (!data.length > 0) SwalToast('warning', 'No hay Programas disponibles.', 2500);\r\n\r\n        return data;\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalLoad('error', 'Ocurrio Un Error', 'Conección Perdida a BD.', false);\r\n    }\r\n}\r\nasync function obtenerPreferencia() {\r\n    try {\r\n        const respuesta = await fetch('tarifa/tipo', {\r\n            method: 'GET'\r\n        });\r\n        const data = await respuesta.json();\r\n\r\n        if (!data.length > 0) SwalToast('warning', 'No hay Tarifas disponibles.', 2500);\r\n\r\n        return data;\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalLoad('error', 'Ocurrio Un Error', 'Conección Perdida a BD.', false);\r\n    }\r\n}\r\nasync function traerTarifas() {\r\n    try {\r\n        const respuesta = await fetch('obtener/tarifas', {\r\n            method: 'GET',\r\n        });\r\n        const data = await respuesta.json();\r\n        // console.log(data);\r\n\r\n        let convert = verificarArray(data);\r\n        gridApi.setGridOption('rowData', convert);\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalToast('warning', 'Error al obtener los datos', 2500);\r\n    }\r\n}\r\n\r\nasync function crearTarifa() {\r\n\r\n    const aeronave_id = $('#aeronave_id').val();\r\n    const tarifa_id = $('#preferencia_id').val();\r\n    const costo_mx = sinComa($('#costo_mx').val());\r\n    const costo_usd = sinComa($('#costo_usd').val());\r\n\r\n    try {\r\n\r\n        const datos = new FormData();\r\n        datos.append('aeronave_id', aeronave_id);\r\n        datos.append('tarifa_id', tarifa_id);\r\n        datos.append('costo_mx', costo_mx);\r\n        datos.append('costo_usd', costo_usd);\r\n\r\n        const respuesta = await fetch('crear/tarifa', {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const data = await respuesta.json();\r\n\r\n        if (data.exito == 1) {\r\n            // Registro Creado Exitosamente\r\n            SwalLoad('success', 'Éxito', 'Registro Creado Correctamente', false);\r\n            setTimeout(() => {\r\n                swal.close();\r\n                resetForm();\r\n                traerTarifas();\r\n            }, 1500);\r\n        } else if (data.exito == 0) {\r\n            SwalLoad('error', 'Error en la Transacción', data.errorSMS, true);\r\n        }\r\n\r\n        if (data.alertas) {\r\n            SwalToast('warning', data.alertas.error, 2500);\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalLoad('error', 'Error en la Conexión', 'Comunicate con el Administrador', false);\r\n    }\r\n}\r\n\r\nasync function actualizarTarifa() {\r\n\r\n    const costo_id = $('#costo_id').val();\r\n    const aeronave_id = $('#aeronave_id').val();\r\n    const tarifa_id = $('#preferencia_id').val();\r\n    const costo_mx = sinComa($('#costo_mx').val());\r\n    const costo_usd = sinComa($('#costo_usd').val());\r\n\r\n    try {\r\n\r\n        const datos = new FormData();\r\n        datos.append('costo_id', costo_id);\r\n        datos.append('aeronave_id', aeronave_id);\r\n        datos.append('tarifa_id', tarifa_id);\r\n        datos.append('costo_mx', costo_mx);\r\n        datos.append('costo_usd', costo_usd);\r\n\r\n        const respuesta = await fetch('actualizar/tarifa', {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const data = await respuesta.json();\r\n        // console.log(data);\r\n\r\n        if (data.exito == 1) {\r\n            // Registro Creado Exitosamente\r\n            SwalLoad('success', 'Éxito', 'Registro Actualizado Correctamente', false);\r\n            setTimeout(() => {\r\n                swal.close();\r\n                resetForm();\r\n                traerTarifas();\r\n            }, 1500);\r\n        } else if (data.exito == 0) {\r\n            SwalLoad('error', 'Error en la Transacción', data.errorSMS, true);\r\n        }\r\n        if (data.alertas) {\r\n            SwalToast('warning', data.alertas.error, 2500);\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalLoad('error', 'Error en la Conexión', 'Comunicate con el Administrador', false);\r\n    }\r\n\r\n}"]}