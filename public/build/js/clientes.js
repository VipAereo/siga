let gridOptions,currentStep=1;function asignarEventos(){$(".empresaSearch").hide(),$(".prefSearch").hide(),document.addEventListener("keydown",a=>{"Escape"===a.key&&resetForm()}),document.getElementById("preferencia_id").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".prefSearch").show(),$(".inPrefSrch").focus();let e=await obtenerPreferencia();await mostrarListaSearch(e,".prefSearch","tipo_id","nombre")}))}function configurarBotones(){$(".contenedor-altas").hide(),$("#crear-cliente").click(mostrarContenedorAltas),$(".btn-next").click((function(a){let e;a.preventDefault(),1==currentStep&&(e=validateInputs($("#cliente_form-personal"))),2==currentStep&&(e=validateInputs($("#cliente_form-contacto"))),e&&($("#paso"+currentStep).hide(),currentStep++,$("#paso"+currentStep).show(),updateActiveClass())})),$(".btn-prev").click((function(a){a.preventDefault(),$("#paso"+currentStep).hide(),currentStep--,$("#paso"+currentStep).show(),updateRemoveClass()})),$(".btnCancel").click(a=>{resetForm()}),$("#btnGuardar").click(a=>{validateInputs($("#cliente_form-fiscal"))&&(""==$("#cliente_id").val()?crearCliente():actualizarCliente())}),updateActiveClass(),updateRemoveClass()}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"cliente_id",width:80},{headerName:"Nombre",field:"nombre",width:180},{headerName:"Email",field:"email",width:150},{headerName:"Télefono",field:"telefono",width:150},{headerName:"Rfc",field:"rfc",width:130},{headerName:"Ciudad",field:"ciudad",width:120},{headerName:"Tarifa",field:"tipo_nombre",width:120},{headerName:"Estatus",field:"estatus",width:100},{headerName:"Acción",cellRenderer:function(a){const e=document.createElement("I");e.className="fa-regular fa-pen-to-square btn btn-editar",e.title="Editar",e.addEventListener("click",(async function(){await mostrarContenedorAltas(),$("#cliente_id").val(a.data.cliente_id),$("#nombre").val(a.data.nombre),$("#apellido").val(a.data.apellido),$("#sexo").val(a.data.sexo),$("#fecha_nacimiento").val(a.data.fecha_nacimiento),$("#estatus").val(a.data.estatus),$("#email").val(a.data.email),$("#telefono").val(a.data.telefono),$("#pais").val(a.data.pais),$("#ciudad").val(a.data.ciudad),$("#codigo_postal").val(a.data.codigo_postal),$("#estado").val(a.data.estado),$("#colonia").val(a.data.colonia),$("#calle").val(a.data.calle),$("#num_ext").val(a.data.num_ext),$("#num_int").val(a.data.num_int),$("#rfc").val(a.data.rfc),$("#curp").val(a.data.curp),$("#regimen_fiscal").val(a.data.regimen_fiscal),$("#razon_social").val(a.data.razon_social),$("#preferencia_id option").val(a.data.tarifa_id),$("#preferencia_id option").text(a.data.tipo_nombre)}));const t=document.createElement("div");return t.classList="btn-cont centrado",t.appendChild(e),t},width:150,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traeClientes()}function resetForm(){cerrarVentana(".contenedor-altas",["#cliente_form-personal","#cliente_form-contacto","#cliente_form-fiscal"]),$(".altas_pasos p").removeClass("pasoActivo circle-check"),$("#paso1").show(),$("#paso2").hide(),$("#paso3").hide(),$(".paso1 p").addClass("pasoActivo"),currentStep=1,updateRemoveClass(),updateActiveClass()}async function mostrarContenedorAltas(){$(".contenedor-altas").show(),await obtenerEmpresas()}function updateActiveClass(){$(".empleado_pasos p").removeClass("pasoActivo"),1===currentStep?($(".paso1 p").addClass("pasoActivo"),$(".btn-guardar").addClass("hidden"),$(".btn-next").removeClass("hidden")):2===currentStep?($(".paso2 p").addClass("pasoActivo"),$(".paso1 p").addClass("circle-check"),$(".btn-prev").removeClass("invisible")):3===currentStep&&($(".paso3 p").addClass("pasoActivo"),$(".paso2 p").addClass("circle-check"),$(".btn-next").addClass("hidden"),$(".btn-guardar").removeClass("hidden"))}function updateRemoveClass(){$(".empleado_pasos p").removeClass("circle-check"),1===currentStep?($(".paso1 p").addClass("pasoActivo"),$(".paso2 p").removeClass("pasoActivo"),$(".btn-prev").addClass("invisible")):2===currentStep&&($(".paso1 p").addClass("circle-check"),$(".paso2 p").addClass("pasoActivo"),$(".paso3 p").removeClass("pasoActivo"),$(".btn-next").removeClass("hidden"),$(".btn-guardar").addClass("hidden"))}async function traeClientes(){try{const a=await fetch("allClientes",{method:"GET"}),e=await a.json();let t=verificarArray(e);gridApi.setGridOption("rowData",t)}catch(a){console.error(a),SwalToast("warning","Error al obtener los usuarios",2500)}}async function obtenerEmpresas(){try{const a=await fetch("brokers/activas",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Programas disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function obtenerPreferencia(){try{const a=await fetch("tarifa/tipo",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Tarifas disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function crearCliente(){const a=$("#nombre").val(),e=$("#apellido").val(),t=$("#sexo").val(),n=$("#fecha_nacimiento").val(),o=$("#estatus").val(),r=$("#preferencia_id").val(),i=$("#email").val(),l=$("#telefono").val(),s=$("#pais").val(),c=$("#ciudad").val(),d=$("#codigo_postal").val(),p=$("#estado").val(),u=$("#colonia").val(),m=$("#calle").val(),v=$("#num_ext").val(),f=$("#num_int").val(),h=$("#rfc").val(),_=$("#curp").val(),C=$("#regimen_fiscal").val(),w=$("#razon_social").val();try{const $=new FormData;$.append("nombre",a),$.append("apellido",e),$.append("sexo",t),$.append("fecha_nacimiento",n),$.append("estatus",o),$.append("tarifa_id",r),$.append("email",i),$.append("telefono",l),$.append("pais",s),$.append("ciudad",c),$.append("codigo_postal",d),$.append("estado",p),$.append("colonia",u),$.append("calle",m),$.append("num_ext",v),$.append("num_int",f),$.append("rfc",h),$.append("curp",_),$.append("regimen_fiscal",C),$.append("razon_social",w);const S=await fetch("crear/cliente",{method:"POST",body:$}),b=await S.json();1==b.exito?(SwalLoad("success","Éxito","Registro Creado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),traeClientes()},1500)):0==b.exito&&SwalLoad("error","Error en la Transacción",b.errorSMS,!0),b.alertas&&SwalToast("warning",b.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function actualizarCliente(){const a=$("#cliente_id").val(),e=$("#nombre").val(),t=$("#apellido").val(),n=$("#sexo").val(),o=$("#fecha_nacimiento").val(),r=$("#estatus").val(),i=$("#preferencia_id").val(),l=$("#email").val(),s=$("#telefono").val(),c=$("#pais").val(),d=$("#ciudad").val(),p=$("#codigo_postal").val(),u=$("#estado").val(),m=$("#colonia").val(),v=$("#calle").val(),f=$("#num_ext").val(),h=$("#num_int").val(),_=$("#rfc").val(),C=$("#curp").val(),w=$("#regimen_fiscal").val(),S=$("#razon_social").val();try{const $=new FormData;$.append("cliente_id",a),$.append("nombre",e),$.append("apellido",t),$.append("sexo",n),$.append("fecha_nacimiento",o),$.append("estatus",r),$.append("tarifa_id",i),$.append("email",l),$.append("telefono",s),$.append("pais",c),$.append("ciudad",d),$.append("codigo_postal",p),$.append("estado",u),$.append("colonia",m),$.append("calle",v),$.append("num_ext",f),$.append("num_int",h),$.append("rfc",_),$.append("curp",C),$.append("regimen_fiscal",w),$.append("razon_social",S);const b=await fetch("actualizar/cliente",{method:"POST",body:$}),g=await b.json();1==g.exito?(SwalLoad("success","Éxito","Registro Actualizado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),traeClientes()},1500)):0==g.exito&&SwalLoad("error","Error en la Transacción",g.errorSMS,!0),g.alertas&&SwalToast("warning",g.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=clientes.js.map
