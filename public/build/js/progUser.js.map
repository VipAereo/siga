{"version":3,"sources":["progUser.js"],"names":["gridOptions","USUARIOS_ACTIVOS","asignarEventos","document","addEventListener","e","key","cerrarVentana","configurarBotones","$","hide","click","resetearTabla","limpiarForm","dataGrid","getDataFromGrid","datosInsertar","filter","item1","unionArrays","find","item2","programa_id","nombre","rel","relacion","datosEliminar","length","crearRelacion","eliminarRelacion","inicializarPagina","iniciarTabla","headerName","field","width","cellRenderer","params","editButton","createElement","className","title","async","text","data","nombre_user","val","usuario_id","mostrarContenedorAltas","keydownListener","removeEventListener","actionContainer","classList","appendChild","headerClass","cellClass","traerProgUsuarios","respuesta","fetch","method","json","convert","verificarArray","gridApi","setGridOption","error","console","SwalToast","show","editable","cellEditor","obtenerRelaciones","datos","FormData","append","body","map","item","JSON","stringify","exito","SwalLoad","setTimeout","swal","close","errorSMS","alertas"],"mappings":"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","file":"progUser.js","sourcesContent":["let gridOptions;\r\nlet USUARIOS_ACTIVOS = '';\r\n\r\n// Utilizando el Principio de Modularidad\r\n$(function () {\r\n    asignarEventos();\r\n    inicializarPagina();\r\n    configurarBotones();\r\n});\r\n\r\nfunction asignarEventos() {\r\n\r\n    document.addEventListener(\"keydown\", e => {\r\n        if (e.key === 'Escape') {\r\n            cerrarVentana('.contenedor-altas', ['#formAltas']);\r\n        }\r\n    });\r\n}\r\n\r\nfunction configurarBotones() {\r\n    $(\".contenedor-altas\").hide();\r\n\r\n    $(\"#btnCancel\").click(e => {\r\n        resetearTabla('#myGrid2', '#searchInput1');\r\n        limpiarForm(\"#formAltas\");\r\n        $(\".contenedor-altas\").hide();\r\n    });\r\n\r\n    $(\"#btnGuardar\").click(e => {\r\n        let dataGrid = getDataFromGrid();\r\n        let datosInsertar = USUARIOS_ACTIVOS.filter(function (item1) {\r\n            let unionArrays = dataGrid.find(function (item2) {\r\n                return item1.programa_id === item2.programa_id && item1.nombre === item2.nombre;\r\n            });\r\n            return unionArrays && !item1.rel && unionArrays.relacion;\r\n        });\r\n        let datosEliminar = USUARIOS_ACTIVOS.filter(function (item1) {\r\n            let unionArrays = dataGrid.find(function (item2) {\r\n                return item1.programa_id === item2.programa_id && item1.nombre === item2.nombre;\r\n            });\r\n            return unionArrays && item1.rel && !unionArrays.relacion;\r\n        });\r\n\r\n        if (datosInsertar.length > 0) crearRelacion(datosInsertar);\r\n        if (datosEliminar.length > 0) eliminarRelacion(datosEliminar);\r\n\r\n    });\r\n}\r\n\r\nfunction inicializarPagina() {\r\n\r\n    let columnDefs = [\r\n        {\r\n            headerName: 'id',\r\n            field: 'usuario_id',\r\n            width: 80\r\n        },\r\n        {\r\n            headerName: 'Rol',\r\n            field: 'nombre_user',\r\n            width: 400,\r\n        },\r\n        {\r\n            headerName: 'Acción',\r\n            cellRenderer: function (params) {\r\n                // Btn Editar\r\n                const editButton = document.createElement('I');\r\n                editButton.className = \"fa-regular fa-pen-to-square btn btn-editar\";\r\n                editButton.title = 'Editar';\r\n\r\n                editButton.addEventListener('click', async function () {\r\n                    $(\"#user-title\").text(`Usuario - ${params.data.nombre_user}`);\r\n                    $('#usuario_id').val(params.data.usuario_id);\r\n\r\n                    await mostrarContenedorAltas(params.data.usuario_id);\r\n\r\n                    function keydownListener(e) {\r\n                        if (e.key === 'Escape') {\r\n                            resetearTabla('#myGrid2', '#searchInput1');\r\n\r\n                            // Eliminar el event listener después de usarlo\r\n                            document.removeEventListener(\"keydown\", keydownListener);\r\n                        }\r\n                    }\r\n                    document.addEventListener(\"keydown\", keydownListener);\r\n                });\r\n\r\n                // Crea un contenedor para los botones y los agrega\r\n                const actionContainer = document.createElement('div');\r\n                actionContainer.classList = \"btn-cont centrado\";\r\n                actionContainer.appendChild(editButton);\r\n\r\n                return actionContainer;\r\n            },\r\n            width: 160,\r\n            headerClass: 'txt-center',\r\n            cellClass: 'custom-action-cell', // Agregar la clase CSS 'custom-action-cell' a todas las celdas en esta columna\r\n            filter: false\r\n        },\r\n    ];\r\n    let data = '';\r\n    iniciarTabla(data, columnDefs, '#myGrid');\r\n    traerProgUsuarios();\r\n}\r\n/*  FUNCIONES  */\r\nasync function traerProgUsuarios() {\r\n\r\n    try {\r\n        const respuesta = await fetch('usuarios/activos', {\r\n            method: 'GET',\r\n        });\r\n        const data = await respuesta.json();\r\n\r\n        let convert = verificarArray(data);\r\n        gridApi.setGridOption('rowData', convert);\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalToast('warning', 'Error al obtener los usuarios', 2500);\r\n    }\r\n}\r\n\r\nasync function mostrarContenedorAltas(usuario_id) {\r\n    $(\".contenedor-altas\").show();\r\n\r\n    let columnDefs = [\r\n        {\r\n            headerName: 'id',\r\n            field: 'programa_id',\r\n            width: 80\r\n        },\r\n        {\r\n            headerName: 'nombre',\r\n            field: 'nombre',\r\n            width: 400\r\n        },\r\n        {\r\n            headerName: 'Selección',\r\n            field: 'relacion',\r\n            editable: true,\r\n            width: 150,\r\n            cellRenderer: 'agCheckboxCellRenderer',\r\n            cellEditor: 'agCheckboxCellEditor',\r\n        },\r\n    ];\r\n\r\n    let data = '';\r\n    iniciarTabla(data, columnDefs, '#myGrid2');\r\n    obtenerRelaciones(usuario_id);\r\n}\r\n\r\nasync function obtenerRelaciones(usuario_id) {\r\n\r\n    try {\r\n        const datos = new FormData();\r\n        datos.append('usuario_id', usuario_id);\r\n\r\n        const respuesta = await fetch('progUsuario/relaciones', {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n        const data = await respuesta.json();\r\n\r\n        USUARIOS_ACTIVOS = data.map(item => ({\r\n            programa_id: item.programa_id,\r\n            nombre: item.nombre,\r\n            rel: item.relacion\r\n        }));\r\n\r\n        let convert = verificarArray(data);\r\n        gridApi.setGridOption('rowData', convert);\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalToast('warning', 'Error al obtener los usuarios', 2500);\r\n    }\r\n\r\n}\r\n\r\nasync function crearRelacion(datosInsertar) {\r\n\r\n    let usuario_id = $(\"#usuario_id\").val();\r\n\r\n    try {\r\n        const datos = new FormData();\r\n        datos.append('usuario_id', usuario_id);\r\n        datos.append('datosInsertar', JSON.stringify(datosInsertar));\r\n\r\n        const respuesta = await fetch('crear/progUsuarios', {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const data = await respuesta.json();\r\n\r\n        if (data.exito == 1) {\r\n            SwalLoad('success', 'Éxito', 'Relación Creada Correctamente', false);\r\n            setTimeout(() => {\r\n                swal.close();\r\n                obtenerRelaciones(usuario_id);\r\n            }, 1500);\r\n        } else if (data.exito == 0) {\r\n            SwalLoad('error', 'Error en la Transacción', data.errorSMS, true);\r\n        }\r\n\r\n        if (data.alertas) {\r\n            SwalToast('warning', data.alertas.error, 2500);\r\n            cerrarVentana('.contenedor-altas', ['#formAltas']);\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalLoad('error', 'Error en la Conexión', 'Comunicate con el Administrador', false);\r\n    }\r\n}\r\n\r\nasync function eliminarRelacion(datosEliminar) {\r\n\r\n    let usuario_id = $(\"#usuario_id\").val();\r\n\r\n    try {\r\n\r\n        const datos = new FormData();\r\n        datos.append('usuario_id', usuario_id);\r\n        datos.append('datosEliminar', JSON.stringify(datosEliminar));\r\n\r\n        const respuesta = await fetch('eliminar/progUsuarios', {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const data = await respuesta.json();\r\n\r\n        if (data.exito == 1) {\r\n            SwalLoad('success', 'Éxito', 'Relación Eliminada Correctamente', false);\r\n            setTimeout(() => {\r\n                swal.close();\r\n                obtenerRelaciones(usuario_id);\r\n            }, 1500);\r\n        } else if (data.exito == 0) {\r\n            SwalLoad('error', 'Error en la Transacción', data.errorSMS, true);\r\n        }\r\n\r\n        if (data.alertas) {\r\n            SwalToast('warning', data.alertas.error, 2500);\r\n            cerrarVentana('.contenedor-altas', ['#formAltas']);\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        SwalLoad('error', 'Error en la Conexión', 'Comunicate con el Administrador', false);\r\n    }\r\n}\r\n"]}