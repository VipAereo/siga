let gridOptions;function asignarEventos(){$(".empleadoSearch").hide(),$(".rolSearch").hide(),document.addEventListener("keydown",a=>{"Escape"===a.key&&cerrarVentana(".contenedor-altas",["#formAltas"])}),document.getElementById("empleado_user").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".empleadoSearch").show(),$(".inEmplSrch").focus();let e=await obtenerEmpleados();await mostrarListaSearch(e,".empleadoSearch","empleado_id","nombre")})),document.getElementById("rol_user").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".rolSearch").show(),$(".inRollSrch").focus();let e=await obtenerRoles();await mostrarListaSearch(e,".rolSearch","rol_id","nombre_rol")}))}function configurarBotones(){$(".contenedor-altas").hide(),$("#crear-usuario").click(mostrarContenedorAltas),$("#btnCancel").click(a=>{limpiarForm("#formAltas"),$(".contenedor-altas").hide()}),$("#btnGuardar").click(a=>{validateInputs($("#formAltas"))&&(""==$("#usuario_id").val()?crearUsuario():actualizarUsuario())})}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"usuario_id",width:60},{headerName:"Nombre Completo",field:"nombre_completo",width:150},{headerName:"Usuario",field:"nombre_user",width:100},{headerName:"Empleado",field:"empleado_nombre",width:100},{headerName:"Rol",field:"rol_nombre",width:120},{headerName:"Estatus",field:"estatus",width:80},{headerName:"Fecha Creación",field:"fecha_creacion",width:102,filter:"agDateColumnFilter"},{headerName:"Acción",cellRenderer:function(a){const e=document.createElement("I");e.className="fa-regular fa-pen-to-square btn btn-editar",e.title="Editar",e.addEventListener("click",(async function(){await mostrarContenedorAltas(),$("#usuario_id").val(a.data.usuario_id),$("#nombre_completo").val(a.data.nombre_completo),$("#nombre_user").val(a.data.nombre_user),$("#password").val("none"),$("#estatus_user").val(a.data.estatus),$("#rol_user option").val(a.data.rol_id),$("#rol_user option").text(a.data.rol_nombre),$("#empleado_user option").val(a.data.empleado_id),$("#empleado_user option").text(a.data.empleado_nombre)}));const r=document.createElement("div");return r.classList="btn-cont centrado",r.appendChild(e),r},width:150,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traerUsuarios()}function onQuickFilterChanged(){var a=document.getElementById("quickFilter").value;gridApi.updateGridOptions({quickFilterText:a})}async function traerUsuarios(){try{const a=await fetch("/obtener/usuarios",{method:"GET"}),e=await a.json();e.map(a=>({nombre_user:a.nombre_user}));let r=verificarArray(e);gridApi.setGridOption("rowData",r)}catch(a){console.error(a),SwalToast("warning","Error al obtener los usuarios",2500)}}async function mostrarContenedorAltas(){$(".contenedor-altas").show(),await obtenerEmpleados(),await obtenerRoles()}async function crearUsuario(){const a=$("#nombre_completo").val(),e=$("#nombre_user").val(),r=$("#password").val(),o=$("#estatus_user").val(),t=$("#empleado_user").val(),n=$("#rol_user").val();try{const s=new FormData;s.append("nombre_completo",a),s.append("nombre_user",e),s.append("password",r),s.append("estatus",o),s.append("empleado_id",t),s.append("rol_id",n);const i=await fetch("crear/usuario",{method:"POST",body:s}),l=await i.json();1==l.exito?(SwalLoad("success","Éxito","Usuario Creado Correctamente",!1),setTimeout(()=>{swal.close(),cerrarVentana(".contenedor-altas",["#formAltas"]),traerUsuarios()},1500)):0==l.exito&&SwalLoad("error","Error en la Transacción",l.errorSMS,!0),l.alertas&&(SwalToast("warning",l.alertas.error,2500),cerrarVentana(".contenedor-altas",["#formAltas"]))}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function actualizarUsuario(){const a=$("#usuario_id").val(),e=$("#nombre_completo").val(),r=$("#nombre_user").val(),o=$("#password").val(),t=$("#estatus_user").val(),n=$("#empleado_user").val(),s=$("#rol_user").val();try{const i=new FormData;i.append("usuario_id",a),i.append("nombre_completo",e),i.append("nombre_user",r),i.append("password",o),i.append("estatus",t),i.append("empleado_id",n),i.append("rol_id",s);const l=await fetch("actualizar/usuario",{method:"POST",body:i}),c=await l.json();1==c.exito?(SwalLoad("success","Éxito","Usuario Actualizado Correctamente",!1),setTimeout(()=>{swal.close(),cerrarVentana(".contenedor-altas",["#formAltas"]),traerUsuarios()},1500)):0==c.exito&&SwalLoad("error","Error en la Transacción",c.errorSMS,!0),c.alertas&&(SwalToast("warning",c.alertas.error,2500),cerrarVentana(".contenedor-altas",["#formAltas"]))}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function obtenerEmpleados(){try{const a=await fetch("empleados/activos",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Empleados disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function obtenerRoles(){try{const a=await fetch("roles/activos",{method:"GET"}),e=await a.json();return!e.length>0&&SwalToast("warning","No hay Roles disponibles.",2500),e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function eliminarUser(a){try{const e=new FormData;e.append("usuario_id",a.usuario_id);const r=await fetch("eliminar/usuario",{method:"POST",body:e}),o=await r.json();1==o.exito&&(SwalLoad("success","Eliminado","Registro Eliminado Correctamente",!1),setTimeout(()=>{swal.close(),traerUsuarios()},1500)),o.alertas&&SwalToast("warning",o.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=usuarios.js.map
