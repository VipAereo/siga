let gridOptions,AEROPUERTOS;function asignarEventos(){$(".aeropSearch").hide(),$(".origenSearch").hide(),$(".destinoSearch").hide(),aplicarMascaraKm("distancia"),document.addEventListener("keydown",a=>{"Escape"===a.key&&resetForm()}),document.getElementById("aeropuerto_id").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".aeropSearch").show(),$(".inAeropSrch").focus();let e=await obtenerAeropuertos();await mostrarListaSearch(e,".aeropSearch","aeropuerto_id","municipio")})),document.getElementById("origen").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".origenSearch").show(),$(".inOrigenSrch").focus();let e=await obtenerAeropuertos();await mostrarListaSearch(e,".origenSearch","aeropuerto_id","municipio");calcualarDistancia()})),document.getElementById("destino").addEventListener("mousedown",(async function(a){a.preventDefault(),$(".destinoSearch").show(),$(".inDestinoSrch").focus();let e=await obtenerAeropuertos();await mostrarListaSearch(e,".destinoSearch","aeropuerto_id","municipio");calcualarDistancia()}))}function configurarBotones(){$(".contenedor-altas").hide(),$("#crear-ruta").click(mostrarContenedorAltas),$(".btn-cancelar").click(a=>{resetForm()}),$("#btnGuardar").click(a=>{validateInputs($("#formAltas"))&&(""==$("#ruta_id").val()?crearRuta():actualizarRuta())})}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"ruta_id",width:80},{headerName:"Aeropuerto",field:"nombre_aeropuerto",width:250},{headerName:"Origen",field:"nombre_origen",width:170},{headerName:"Destino",field:"nombre_destino",width:170},{headerName:"Tipo de Vuelo",field:"tipo_vuelo",width:120,cellEditor:"agSelectCellEditor",cellRenderer:function(a){return"N"===a.value?"Nacional":"I"===a.value?"Internacional":a.value}},{headerName:"Distancia",field:"distancia",width:120},{headerName:"Estatus",field:"estado_ruta",width:120},{headerName:"Acción",cellRenderer:function(a){const e=document.createElement("I");e.className="fa-regular fa-pen-to-square btn btn-editar",e.title="Editar",e.addEventListener("click",(async function(){await mostrarContenedorAltas(),$("#ruta_id").val(a.data.ruta_id),$("#distancia").val(a.data.distancia),$("#estado_ruta").val(a.data.estado_ruta),$("#aeropuerto_id option").val(a.data.aeropuerto_id),$("#aeropuerto_id option").text(a.data.nombre_aeropuerto),$("#origen option").val(a.data.origen),$("#origen option").text(a.data.nombre_origen),$("#destino option").val(a.data.destino),$("#destino option").text(a.data.nombre_destino)}));const t=document.createElement("div");return t.classList="btn-cont centrado",t.appendChild(e),t},width:150,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traeRutas()}function resetForm(){cerrarVentana(".contenedor-altas",["#formAltas"])}function calcualarDistancia(){let a=$("#origen").val(),e=$("#destino").val();if(a&&e){const t=AEROPUERTOS.find(e=>e.aeropuerto_id==a);let r=t.latitud,o=t.longitud;const n=AEROPUERTOS.find(a=>a.aeropuerto_id==e);let i=obtenerDistancia({latOrigen:r,lonOrigen:o,latDest:n.latitud,lonDest:n.longitud});$("#distancia").val(i)}}async function mostrarContenedorAltas(){$(".contenedor-altas").show(),await obtenerAeropuertos()}async function traeRutas(){try{const a=await fetch("obtener/rutas",{method:"GET"}),e=await a.json();let t=verificarArray(e);gridApi.setGridOption("rowData",t)}catch(a){console.error(a),SwalToast("warning","Error al obtener los datos",2500)}}async function obtenerAeropuertos(){try{const a=await fetch("allAeropuertos",{method:"GET"}),e=await a.json();return AEROPUERTOS=e,e}catch(a){console.error(a),SwalLoad("error","Ocurrio Un Error","Conección Perdida a BD.",!1)}}async function crearRuta(){const a=$("#origen").val(),e=$("#destino").val(),t=$("#distancia").val(),r=$("#estado_ruta").val(),o=$("#aeropuerto_id").val();try{const n=new FormData;n.append("origen",a),n.append("destino",e),n.append("distancia",t),n.append("estado_ruta",r),n.append("aeropuerto_id",o);const i=await fetch("crear/ruta",{method:"POST",body:n}),d=await i.json();1==d.exito?(SwalLoad("success","Éxito","Registro Creado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),traeRutas()},1500)):0==d.exito&&SwalLoad("error","Error en la Transacción",d.errorSMS,!0),d.alertas&&SwalToast("warning",d.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function actualizarRuta(){const a=$("#ruta_id").val(),e=$("#origen").val(),t=$("#destino").val(),r=$("#distancia").val(),o=$("#estado_ruta").val(),n=$("#aeropuerto_id").val();try{const i=new FormData;i.append("ruta_id",a),i.append("origen",e),i.append("destino",t),i.append("distancia",r),i.append("estado_ruta",o),i.append("aeropuerto_id",n);const d=await fetch("actualizar/ruta",{method:"POST",body:i}),s=await d.json();1==s.exito?(SwalLoad("success","Éxito","Registro Actualizado Correctamente",!1),setTimeout(()=>{swal.close(),resetForm(),traeRutas()},1500)):0==s.exito&&SwalLoad("error","Error en la Transacción",s.errorSMS,!0),s.alertas&&SwalToast("warning",s.alertas.error,2500)}catch(a){console.error(a),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}function obtenerDistancia(a){const{latDest:e,latOrigen:t,lonDest:r,lonOrigen:o}=a;var n=degToRad(t),i=degToRad(o),d=degToRad(e),s=d-n,c=degToRad(r)-i,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(n)*Math.cos(d)*Math.sin(c/2)*Math.sin(c/2);return(6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))).toFixed(2)+" Km"}function degToRad(a){return a*(Math.PI/180)}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=rutas.js.map
