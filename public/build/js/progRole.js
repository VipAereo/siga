let gridOptions,ROLES_ACTIVOS="";function asignarEventos(){document.addEventListener("keydown",e=>{"Escape"===e.key&&cerrarVentana(".contenedor-altas",["#formAltas"])})}function configurarBotones(){$(".contenedor-altas").hide(),$("#btnCancel").click(e=>{resetearTabla("#myGrid2","#searchInput1"),limpiarForm("#formAltas"),$(".contenedor-altas").hide()}),$("#btnGuardar").click(e=>{let r=getDataFromGrid(),a=ROLES_ACTIVOS.filter((function(e){let a=r.find((function(r){return e.programa_id===r.programa_id&&e.nombre===r.nombre}));return a&&!e.rel&&a.relacion})),o=ROLES_ACTIVOS.filter((function(e){let a=r.find((function(r){return e.programa_id===r.programa_id&&e.nombre===r.nombre}));return a&&e.rel&&!a.relacion}));a.length>0&&crearRelacion(a),o.length>0&&eliminarRelacion(o)})}function inicializarPagina(){iniciarTabla("",[{headerName:"id",field:"rol_id",width:80},{headerName:"Rol",field:"nombre_rol",width:400},{headerName:"Acción",cellRenderer:function(e){const r=document.createElement("I");r.className="fa-regular fa-pen-to-square btn btn-editar",r.title="Editar",r.addEventListener("click",(async function(){$("#rol-title").text("Rol - "+e.data.nombre_rol),$("#rol_id").val(e.data.rol_id),await mostrarContenedorAltas(e.data.rol_id),document.addEventListener("keydown",(function e(r){"Escape"===r.key&&(resetearTabla("#myGrid2","#searchInput1"),document.removeEventListener("keydown",e))}))}));const a=document.createElement("div");return a.classList="btn-cont centrado",a.appendChild(r),a},width:160,headerClass:"txt-center",cellClass:"custom-action-cell",filter:!1}],"#myGrid"),traerProgRoles()}async function traerProgRoles(){try{const e=await fetch("roles/activos",{method:"GET"}),r=await e.json();let a=verificarArray(r);gridApi.setGridOption("rowData",a)}catch(e){console.error(e),SwalToast("warning","Error al obtener los usuarios",2500)}}async function mostrarContenedorAltas(e){$(".contenedor-altas").show();iniciarTabla("",[{headerName:"id",field:"programa_id",width:80},{headerName:"nombre",field:"nombre",width:400},{headerName:"Selección",field:"relacion",width:150,editable:!0,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor"}],"#myGrid2"),obtenerRelaciones(e)}async function obtenerRelaciones(e){try{const r=new FormData;r.append("rol_id",e);const a=await fetch("progRole/relaciones",{method:"POST",body:r}),o=await a.json();ROLES_ACTIVOS=o.map(e=>({programa_id:e.programa_id,nombre:e.nombre,relacion:e.relacion}));let n=verificarArray(o);gridApi.setGridOption("rowData",n)}catch(e){console.error(e),SwalToast("warning","Error al obtener los usuarios",2500)}}async function crearRelacion(e){let r=$("#rol_id").val();try{const a=new FormData;a.append("rol_id",r),a.append("datosInsertar",JSON.stringify(e));const o=await fetch("crear/progRoles",{method:"POST",body:a}),n=await o.json();1==n.exito?(SwalLoad("success","Éxito","Relación Creada Correctamente",!1),setTimeout(()=>{swal.close(),obtenerRelaciones(r)},1500)):0==n.exito&&SwalLoad("error","Error en la Transacción",n.errorSMS,!0),n.alertas&&(SwalToast("warning",n.alertas.error,2500),cerrarVentana(".contenedor-altas",["#formAltas"]))}catch(e){console.error(e),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}async function eliminarRelacion(e){let r=$("#rol_id").val();try{const a=new FormData;a.append("rol_id",r),a.append("datosEliminar",JSON.stringify(e));const o=await fetch("eliminar/progRoles",{method:"POST",body:a}),n=await o.json();1==n.exito?(SwalLoad("success","Éxito","Relación Eliminada Correctamente",!1),setTimeout(()=>{swal.close(),obtenerRelaciones(r)},1500)):0==n.exito&&SwalLoad("error","Error en la Transacción",n.errorSMS,!0),n.alertas&&(SwalToast("warning",n.alertas.error,2500),cerrarVentana(".contenedor-altas",["#formAltas"]))}catch(e){console.error(e),SwalLoad("error","Error en la Conexión","Comunicate con el Administrador",!1)}}$((function(){asignarEventos(),inicializarPagina(),configurarBotones()}));
//# sourceMappingURL=progRole.js.map
